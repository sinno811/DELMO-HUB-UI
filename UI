Library = {}
SaveTheme = {}

-- ธีม
local themes = {
    index = {'Dark', 'Amethyst'},
    Amethyst = {
        ['Shadow'] = Color3.fromRGB(24, 24, 31),
        ['Background'] = Color3.fromRGB(29, 28, 38),
        ['Page'] = Color3.fromRGB(24, 24, 31),
        ['Main'] = Color3.fromRGB(91, 68, 209),
        ['Text & Icon'] = Color3.fromRGB(255, 255, 255),
        ['Function'] = {}
    },
    Dark = {
        ['Shadow'] = Color3.fromRGB(15, 15, 15),
        ['Background'] = Color3.fromRGB(20, 20, 20),
        ['Page'] = Color3.fromRGB(18, 18, 18),
        ['Main'] = Color3.fromRGB(50, 50, 50),
        ['Text & Icon'] = Color3.fromRGB(230, 230, 230),
        ['Function'] = {}
    }
}

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "Dummy Kawaii"
ScreenGui.Parent = not game:GetService("RunService"):IsStudio() and game:GetService("CoreGui") or game:GetService("Players").LocalPlayer.PlayerGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local U, Tw = game:GetService("UserInputService"), game:GetService("TweenService")

-- ฟังก์ชันช่วยเหลือ
local function addCloseButton(parent, iconID)
    local CloseBtn = Instance.new("ImageButton")
    CloseBtn.Name = "CloseBtn"
    CloseBtn.Parent = parent
    CloseBtn.AnchorPoint = Vector2.new(1, 0)
    CloseBtn.Position = UDim2.new(1, -5, 0, 5)
    CloseBtn.Size = UDim2.new(0, 20, 0, 20)
    CloseBtn.BackgroundTransparency = 1
    CloseBtn.Image = iconID and gl(iconID).Image or "rbxassetid://7072722740"
    CloseBtn.ImageRectSize = iconID and gl(iconID).ImageRectSize or Vector2.new(0,0)
    CloseBtn.ImageRectOffset = iconID and gl(iconID).ImageRectPosition or Vector2.new(0,0)
    CloseBtn.ImageTransparency = 0.7
    CloseBtn.MouseButton1Click:Connect(function()
        parent.Visible = false
    end)
    return CloseBtn
end

-- ฟังก์ชันสร้าง Background แบบเดิม แต่เพิ่ม Close Button
function background(pl, t, d, i, ty, closeIconID)
    local RealBackground = Instance.new("Frame")
    local Background = Instance.new("Frame")
    local UICorner_1 = Instance.new("UICorner")
    local T_1 = Instance.new("Frame")
    local UIListLayout_2 = Instance.new("UIListLayout")
    local UIPadding_3 = Instance.new("UIPadding")
    local TextLabel_1 = Instance.new("TextLabel")
    local TextLabel_2 = Instance.new("TextLabel")

    RealBackground.Name = "Real Background"
    RealBackground.Parent = pl
    RealBackground.BackgroundTransparency = 1
    RealBackground.BorderSizePixel = 0
    RealBackground.Size = UDim2.new(1, 0, 0, 35)
    RealBackground.ClipsDescendants = true

    Background.Name = "Background"
    Background.Parent = RealBackground
    Background.BackgroundColor3 = Color3.fromRGB(29,28,38)
    Background.Size = UDim2.new(1, 0,1, 0)
    Background.ClipsDescendants = true

    addToTheme('Function.'..ty..'.Background', Background)

    UICorner_1.Parent = Background

    T_1.Name = "T"
    T_1.Parent = Background
    T_1.AnchorPoint = Vector2.new(0, 0.5)
    T_1.BackgroundTransparency = 1
    T_1.Position = UDim2.new(0, 0,0.5, 0)
    T_1.Size = UDim2.new(1, 0,1, 0)

    UIListLayout_2.Parent = T_1
    UIListLayout_2.SortOrder = Enum.SortOrder.LayoutOrder
    UIListLayout_2.VerticalAlignment = Enum.VerticalAlignment.Center

    UIPadding_3.Parent = T_1
    UIPadding_3.PaddingLeft = UDim.new(0,13)
    UIPadding_3.PaddingRight = UDim.new(0,70)

    TextLabel_1.Parent = T_1
    TextLabel_1.BackgroundTransparency = 1
    TextLabel_1.Size = UDim2.new(1,0,0,14)
    TextLabel_1.Font = Enum.Font.GothamBold
    TextLabel_1.RichText = true
    TextLabel_1.Text = tostring(d)
    TextLabel_1.TextColor3 = Color3.fromRGB(255,255,255)
    TextLabel_1.TextSize = 10
    TextLabel_1.TextTransparency = 0.7
    TextLabel_1.TextWrapped = true
    TextLabel_1.TextXAlignment = Enum.TextXAlignment.Left
    TextLabel_1.Visible = d and d ~= ""
    TextLabel_1.AutomaticSize = Enum.AutomaticSize.Y
    TextLabel_1.Name = 'Desc'

    addToTheme('Text & Icon', TextLabel_1)

    TextLabel_2.Parent = T_1
    TextLabel_2.BackgroundTransparency = 1
    TextLabel_2.Size = UDim2.new(1,0,0,14)
    TextLabel_2.Font = Enum.Font.GothamBold
    TextLabel_2.RichText = true
    TextLabel_2.Text = tostring(t)
    TextLabel_2.TextColor3 = Color3.fromRGB(255,255,255)
    TextLabel_2.TextSize = 12
    TextLabel_2.TextWrapped = true
    TextLabel_2.TextXAlignment = Enum.TextXAlignment.Left
    TextLabel_2.AutomaticSize = Enum.AutomaticSize.Y
    TextLabel_2.Name = 'Title'

    addToTheme('Text & Icon', TextLabel_2)

    -- ใส่ไอคอน Background
    if i and i ~= "" then
        UIPadding_3.PaddingLeft = UDim.new(0, 50)
        local Image = Instance.new("Frame")
        local Icon_1 = Instance.new("ImageLabel")
        local Frame_1 = Instance.new("Frame")

        Image.Name = "Image"
        Image.Parent = Background
        Image.BackgroundTransparency = 1
        Image.Size = UDim2.new(0, 40,1, 0)

        Icon_1.Name = "Icon"
        Icon_1.Parent = Image
        Icon_1.AnchorPoint = Vector2.new(0.5,0.5)
        Icon_1.BackgroundTransparency = 1
        Icon_1.Position = UDim2.new(0.5,0,0.5,0)
        Icon_1.Size = UDim2.new(0,20,0,20)
        Icon_1.Image = gl(i).Image
        Icon_1.ImageRectSize = gl(i).ImageRectSize
        Icon_1.ImageRectOffset = gl(i).ImageRectPosition
        Icon_1.ImageTransparency = 0.7

        Frame_1.Parent = Image
        Frame_1.AnchorPoint = Vector2.new(1,0.5)
        Frame_1.BackgroundColor3 = Color3.fromRGB(255,255,255)
        Frame_1.BackgroundTransparency = 0.9
        Frame_1.Position = UDim2.new(1,0,0.5,0)
        Frame_1.Size = UDim2.new(0,1,0.7,0)

        addToTheme('Text & Icon', Icon_1)
        addToTheme('Text & Icon', Frame_1)
    end

    -- เพิ่ม Close Button อัตโนมัติ
    local closeBtn = addCloseButton(RealBackground, closeIconID)

    -- ฟังก์ชันเสริมของ Background
    local f = {}
    function f:SetTextTransparencyTitle(vs)
        tw({v = TextLabel_2, t = 0.15, s = Enum.EasingStyle.Linear, d = "Out", g = {TextTransparency = vs}}):Play()
        if i and i ~= "" then
            tw({v = Background.Image.Icon, t = 0.15, s = Enum.EasingStyle.Linear, d = "Out", g = {ImageTransparency = vs}}):Play()
        end
    end
    function f:SetSizeT(vs) UIPadding_3.PaddingRight = UDim.new(0, vs) end
    function f:SetTitle(vs) TextLabel_2.Text = tostring(vs) end
    function f:SetDesc(vs) 
        TextLabel_1.Text = tostring(vs) 
        TextLabel_1.Visible = vs and vs ~= ""
    end
    function f:SetVisibleDesc(vs) TextLabel_2.Visible = vs end

    return RealBackground, f, closeBtn
end
